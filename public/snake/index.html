<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
    <style>
    .p5Canvas{
        display: block;
        margin-left: auto;
        margin-right: auto;
        border-radius: 5px;
    }
    .body{
        background-color: #A0A0A0;
    }
	#heyo{
        display: initial;
        margin: 0px;
        left: calc(50% + 308px);
        position: absolute;
	}
	.a{
		margin: 0px;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
	}
    #ad{
        left: calc(50% - 501.2px);
        height: 600px;
        display: initial;
        margin-top: 0;
        margin-bottom: 0;
        margin-left: 0;
        position: absolute;
        border-radius: 5px;
    }
    /* #i{
        position: absolute;
        margin-left: 8px;
        width: calc(50% - 316px);
        height: 472px;
        top: 136px;
        left: calc(50% + 300px);
        border-radius: 5px;
    } */
    </style>
	<script src="/p5.js"></script>
</head>
<body>
	<script>
		document.body.style = 'background: #A0A0A0;';

		function loginData(){
			let data = {name};
			let options = {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(data)
			}
			fetch("/login", options);
		}

		// let ip;

		// let blocked = [];

		// function untilcolon(x){
		// 	let str = x;
		// 	for(let i = 0; i < str.length; i++){
		// 		if(str.substring(str.length-i-1, str.length-i) == ":"){
		// 			return str.substring(0, str.length-i-1);
		// 		}
		// 	}
		// }

		// async function getIP(){
		// 	let response = await fetch("/login");
		// 	ip = await response.json();
		// 	for(let i = 0; i < blocked.length; i++){
		// 		if(untilcolon(ip) == blocked[i]){
		// 			document.write("<h1 style=\"font-size: 25vh;\">FUCK OFF</h1>");
		// 			window.stop();
		// 		}
		// 	}
		// }
		// getIP();

		let name;

		function getName(){
			if (!(name = prompt("Enter a 3 letter name."))) {
				sendData = () => {};
			}
			else if(name.length < 3){
				getName();
			}
			else{
				loginData();
				name = name.substring(0,3).toUpperCase();
			}
		}

		async function sendData(){// async, await and promises watch from daniel shiffman's Promises playlist
			let data = {name, score};
			let options = {
				method: "POST",// since we are posting a request
				headers: {
					"Content-Type": "application/json"// we are sending a json
				},
				body: JSON.stringify(data)// this is what we are sending
			}
			let response = await fetch("/api", options);// send JSON.stringify(data) and receive a response
			let send = await response.json();// assign the json value of response to data
		}
		// same as fetch("/api", options).then((response) => console.log(response)); but we did this because we need to specify our response is a json
		// ohoo

		getName();
		
		let dataArray = [];

		async function getData(){
			let response = await fetch("/api");// no options because default method is "GET" already
			dataArray = await response.json();

			let x = dataArray.length;
			if(dataArray.length > 9){
				x = 9;
			}

			for(let i = 1; i <= x; i++){
				document.getElementById(i.toString()).textContent = dataArray[i-1].name + " - " + dataArray[i-1].score;
			}
		}

		getData();

	</script>
	<div id="heyo">
		<h1 class="a">Play Count: <span id="playcount">1</span></h1>
		<h1 class="a">Score: <span id="score">0</span></h1>
		<h1 class="a">Highest: <span id="highest">0</span></h1>
		<div style="margin-top: 100.8px;">
			<h1 class="a">Leaderboard</h1>
			<h1 class="a">1. <span id="1"></span></h1>
			<h1 class="a">2. <span id="2"></span></h1>
			<h1 class="a">3. <span id="3"></span></h1>
			<h1 class="a">4. <span id="4"></span></h1>
			<h1 class="a">5. <span id="5"></span></h1>
			<h1 class="a">6. <span id="6"></span></h1>
			<h1 class="a">7. <span id="7"></span></h1>
			<h1 class="a">8. <span id="8"></span></h1>
			<h1 class="a">9. <span id="9"></span></h1>
		</div>
	</div>
    <a href="rickroll.html" target="_blank"><img id="ad" src="ad.jpg" alt="Özel ders saati 15TL" longdesc="Lütfen tıklayın karnım aç yalvarıyorum"></a>
    <!-- <iframe id="i" src="https://open.spotify.com/embed/playlist/6TjyfYv2nzCt2hDV0Kb83B" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe> -->
    <script src="yilan.js"></script>
</body>
</html>
